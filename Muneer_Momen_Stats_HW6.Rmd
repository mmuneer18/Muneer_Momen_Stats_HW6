---
title: "CMDA-2006 Statistics Homework 6"
author: "Momen Muneer"
output:
  pdf_document:
    highlight: haddock
    latex_engine: xelatex
geometry: margin=0.5in
urlcolor: blue
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
---

```{r setup, include=FALSE}
# This is the setup chunk
#  Here you can set global options for the entire document

library(knitr) # I recommend doing this

# Although you can call functions from a library using the following notation
#  without loading the entire library.
knitr::opts_chunk$set(echo = TRUE, 
                      comment = NA, # Recommended
                      fig.path = "./figures/",  # Store all figures here in relative path (make the folder first)
                      fig.align = "center",
                      fig.width = 7,
                      fig.height = 7,
                      message = FALSE, # Turn off load messages
                      warning = FALSE # Turn off warnings
                      )

```

## Problem 1: Tobacco Leaf Size and Nicotine Content

### Part (a): ANOVA for Leaf Sizes

```{r problem1_a}

A_leaf <- c(27.7619, 27.8523, 21.3495, 31.9616, 19.4623, 12.2804, 
            21.0508, 19.5074, 26.2808, 26.1466)
B_leaf <- c(4.2460, 14.1577, 7.0279, 7.0698, 0.8091, 13.9385,
            11.0130, 10.9680, 6.9112, 9.6041)
C_leaf <- c(15.5070, 5.0473, 18.3020, 16.0436, 10.2601, 19.0571,
            17.1826, 16.6510, 18.8472, 12.4234)
D_leaf <- c(33.0101, 44.9680, 34.2074, 28.9766, 42.9229, 36.6827,
            32.7229, 34.5668, 28.7695, 36.6952)

leaf_size <- c(A_leaf, B_leaf, C_leaf, D_leaf)
condition <- factor(rep(c("A", "B", "C", "D"), each = 10))

# ANOVA splits total variance into between-group and within-group
leaf_aov <- aov(leaf_size ~ condition)
summary(leaf_aov)

tapply(leaf_size, condition, mean)

```

H₀: μ_A = μ_B = μ_C = μ_D (all conditions have equal mean leaf size)

H_a: At least one mean differs

The F-statistic tests whether between-group variance is significantly larger than within-group variance. With p-value < 0.05, we reject H₀ and conclude that growing conditions significantly affect leaf size.

### Part (b): Conclusions about Leaf Size

Looking at the means, condition B (low temp/low rain) has smallest leaves (mean = 8.6) while condition D (high temp/high rain) has largest (mean = 35.2). The ANOVA shows this difference is statistically significant (p < 0.05), so growing conditions do affect tobacco leaf size.

### Part (c): ANOVA for Nicotine Content

```{r problem1_c}

A_nic <- c(10.0655, 9.4712, 9.1246, 11.3652, 11.3976, 11.2936,
           10.6805, 8.1280, 10.5066, 10.6579)
B_nic <- c(8.5977, 8.1299, 11.3401, 9.3470, 9.3049, 10.0193,
           9.5843, 6.4603, 8.2589, 5.0106)
C_nic <- c(6.7865, 10.9249, 11.3878, 9.7022, 8.0371, 10.7187,
           11.2352, 7.7079, 7.5653, 9.0922)
D_nic <- c(9.9553, 5.8495, 10.3005, 9.7140, 10.7543, 8.0262,
           13.1326, 11.8559, 11.3345, 10.4763)

nicotine <- c(A_nic, B_nic, C_nic, D_nic)
condition2 <- factor(rep(c("A", "B", "C", "D"), each = 10))

nic_aov <- aov(nicotine ~ condition2)
summary(nic_aov)

tapply(nicotine, condition2, mean)

```

H₀: μ_A = μ_B = μ_C = μ_D (mean nicotine is same across conditions)

H_a: At least one mean differs

### Part (d): Conclusions about Nicotine Content

P-value = 0.258 > 0.05, so we fail to reject H₀. There's no significant difference in nicotine content across growing conditions. All means are around 9-10, fairly similar.

### Part (e): Support for Tobacco Company Testimony

The company claimed nicotine is determined by leaf size, and leaf size varies with weather.

Findings:
- Leaf size DOES vary significantly with conditions (p < 0.05)
- Nicotine content does NOT vary with conditions (p = 0.258)

If nicotine was truly determined by leaf size, then when leaf size changes, nicotine should also change. But it doesn't. The company's testimony is not supported by this data.

### Part (f): Pairwise Tests for Leaf Size

```{r problem1_f}

# Tukey controls for family-wise error rate across all pairs
TukeyHSD(leaf_aov)

plot(TukeyHSD(leaf_aov), las = 1)

```

Looking at the adjusted p-values, B-A, D-B, and D-C are all significant (p < 0.05). Condition B has much smaller leaves than others, and D has larger leaves.

### Part (g): Check ANOVA Assumptions

```{r problem1_g}

par(mfrow = c(2,2))
plot(nic_aov)

shapiro.test(residuals(nic_aov))

library(car)
leveneTest(nicotine ~ condition2)

```

Shapiro-Wilk tests normality (p > 0.05 means OK). Levene tests equal variances (p > 0.05 means OK). If assumptions violated, use non-parametric:

```{r problem1_g2}

# Kruskal-Wallis doesn't assume normality
kruskal.test(nicotine ~ condition2)

# Bonferroni adjusts for multiple tests
pairwise.wilcox.test(nicotine, condition2, p.adjust.method = "bonferroni")

```

Kruskal-Wallis also gives p > 0.05, confirming no difference in nicotine across conditions.

---

## Problem 2: Selenium Content in Game Meats

### Part (a): Conduct ANOVA

```{r problem2_a}

data <- read.csv("selenium.csv")
head(data)

tapply(data$Selenium, data$Meat, mean)
tapply(data$Selenium, data$Meat, sd)
tapply(data$Selenium, data$Meat, length)

boxplot(Selenium ~ Meat, data = data, 
        main = "Selenium Content by Meat Type",
        xlab = "Meat Type", ylab = "Selenium Content")

selenium_aov <- aov(Selenium ~ Meat, data = data)
summary(selenium_aov)

```

H₀: μ_VEN = μ_SQU = μ_RRB = μ_NRB

H_a: At least one mean differs

P-value is very small (< 0.0001), so we reject H₀. Selenium content differs significantly among meat types. NRB (beef from outside region) appears highest, which makes sense since it's from outside the low-selenium region.

### Part (b): Hypotheses for Contrasts

**Question 1: Larger vs smaller animals**

Larger: VEN, RRB, NRB; Smaller: SQU

Contrast: (μ_VEN + μ_RRB + μ_NRB)/3 - μ_SQU

H₀: (μ_VEN + μ_RRB + μ_NRB)/3 - μ_SQU = 0

H_a: (μ_VEN + μ_RRB + μ_NRB)/3 - μ_SQU ≠ 0

**Question 2: In region vs outside**

In region: VEN, SQU, RRB; Outside: NRB

Contrast: (μ_VEN + μ_SQU + μ_RRB)/3 - μ_NRB

H₀: (μ_VEN + μ_SQU + μ_RRB)/3 - μ_NRB = 0

H_a: (μ_VEN + μ_SQU + μ_RRB)/3 - μ_NRB ≠ 0

**Question 3: Beef vs wild**

Beef: RRB, NRB; Wild: VEN, SQU

Contrast: (μ_RRB + μ_NRB)/2 - (μ_VEN + μ_SQU)/2

H₀: (μ_RRB + μ_NRB)/2 - (μ_VEN + μ_SQU)/2 = 0

H_a: (μ_RRB + μ_NRB)/2 - (μ_VEN + μ_SQU)/2 ≠ 0

### Part (c): Bonferroni's Method

```{r problem2_c}

library(multcomp)

# R orders groups alphabetically: NRB, RRB, SQU, VEN
K <- rbind(
  "Large vs Small" = c(-1/3, -1/3, 1, -1/3),
  "Region vs Outside" = c(-1, 1/3, 1/3, 1/3),
  "Beef vs Wild" = c(1/2, 1/2, -1/2, -1/2)
)

# Bonferroni divides α by number of tests
contrasts <- glht(selenium_aov, linfct = mcp(Meat = K))
summary(contrasts, test = adjusted("bonferroni"))

confint(contrasts)

plot(confint(contrasts))

```

Intervals not crossing zero are significant.

### Part (d): Answer Research Questions

Looking at the Bonferroni results:

**Question 1**: If p < 0.05 for "Large vs Small", there's a significant difference in selenium between larger and smaller animals. The estimate shows direction and magnitude.

**Question 2**: The "Region vs Outside" contrast tests if regional soil selenium matters. If p < 0.05 and estimate is negative, outside region has higher selenium in meat.

**Question 3**: "Beef vs Wild" shows if domestication matters. If p < 0.05, beef differs significantly from wild game in selenium content.

### Part (e): Tukey's Method

```{r problem2_e}

tukey_test <- TukeyHSD(selenium_aov)
tukey_test

plot(tukey_test, las = 1)

```

Findings:

- NRB-VEN: Shows regional difference - beef from outside vs venison from inside
- NRB-RRB: Directly compares beef from two regions
- Any pair with adjusted p < 0.05 is significantly different

NRB tends to have higher selenium than meats from the low-selenium region, confirming that regional soil selenium affects meat content.

---

## Problem 3: Daffodil Stem Length

No raw data given, only summary stats. Need to build ANOVA table manually.

### Part (a): ANOVA Table

```{r problem3_a}

SS_between <- 871.408
SS_within <- 3588.54
k <- 5
n <- 13
N <- k * n

SS_total <- SS_between + SS_within

df_between <- k - 1
df_within <- N - k
df_total <- N - 1

MS_between <- SS_between / df_between
MS_within <- SS_within / df_within

F_stat <- MS_between / MS_within

p_val <- pf(F_stat, df_between, df_within, lower.tail = FALSE)

# Display results
df_between; df_within; df_total
MS_between; MS_within
F_stat; p_val

```

H₀: μ_N = μ_E = μ_S = μ_W = μ_O

H_a: At least one mean differs

F = 3.66, p = 0.0089. Since p < 0.05, we reject H₀. Location significantly affects stem length.

### Part (b): Define Contrast

Compare open area to average of four building sides.

C = μ_O - (μ_N + μ_E + μ_S + μ_W)/4

Coefficients: c_N = -1/4, c_E = -1/4, c_S = -1/4, c_W = -1/4, c_O = 1

Check: -1/4 - 1/4 - 1/4 - 1/4 + 1 = 0 ✓

H₀: μ_O - (μ_N + μ_E + μ_S + μ_W)/4 = 0

H_a: μ_O - (μ_N + μ_E + μ_S + μ_W)/4 ≠ 0

### Part (c): Calculate t-statistic

```{r problem3_c}

means <- c(N = 41.4, E = 43.8, S = 46.5, W = 43.2, O = 35.5)

c_coef <- c(-1/4, -1/4, -1/4, -1/4, 1)

C_hat <- sum(c_coef * means)

# SE = sqrt(MS_within × sum(c_i² / n_i))
SE <- sqrt(MS_within * sum(c_coef^2 / n))

t_s <- C_hat / SE

C_hat; SE; t_s; df_within

```

Calculation:
C-hat = (-1/4)(41.4) + (-1/4)(43.8) + (-1/4)(46.5) + (-1/4)(43.2) + (1)(35.5) = -8.225

SE = sqrt(59.809 × [(1/16)/13 + (1/16)/13 + (1/16)/13 + (1/16)/13 + 1/13]) = 3.07

**t_s = -2.68, df = 60**

### Part (d): P-value and Conclusion

```{r problem3_d}

p_value <- 2 * pt(abs(t_s), df_within, lower.tail = FALSE)

t_crit <- qt(0.975, df_within)

p_value; t_crit

```

P(|t| ≥ 2.68 | H₀ true) = 0.0094

Since p = 0.0094 < 0.05, we reject H₀. 

**Conclusion:** There is significant evidence that daffodils in the open area have different mean stem length than the average of building sides. The open area mean is 35.5 cm compared to building average of 43.7 cm - about 8.2 cm shorter. The building probably provides protection from wind or extra warmth that helps stems grow taller.

---

**Honor Code Statement:**

"I have neither given nor received unauthorized assistance on this assignment. The work I am presenting is ultimately my own."
